From 9a1f3e897def6515ebe9237962d1db688a821647 Mon Sep 17 00:00:00 2001
From: Jozef Mlich <jmlich83@gmail.com>
Date: Fri, 11 Aug 2023 07:47:31 +0000
Subject: [PATCH] Fixup build on qt6

---
 .gitignore                    | 1 +
 src/nemowallclock_meego.cpp   | 5 +++++
 src/src.pro                   | 2 +-
 tests/common.pri              | 2 +-
 tests/tests.pro               | 2 +-
 tests/wallclock/wallclock.pro | 2 +-
 6 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/.gitignore b/.gitignore
index 8229377..861f528 100644
--- a/.gitignore
+++ b/.gitignore
@@ -3,3 +3,4 @@
 moc_*
 *.moc
 Makefile
+.qmake.stash
\ No newline at end of file
diff --git a/src/nemowallclock_meego.cpp b/src/nemowallclock_meego.cpp
index 19dcb6b..e642857 100644
--- a/src/nemowallclock_meego.cpp
+++ b/src/nemowallclock_meego.cpp
@@ -34,8 +34,13 @@
 #include <QQmlEngine>
 #include <qqml.h>
 #include <functional>
+#if QT_VERSION >= QT_VERSION_CHECK(6, 0, 0)
+#include <timed-qt6/interface>
+#include <timed-qt6/wallclock>
+#else
 #include <timed-qt5/interface>
 #include <timed-qt5/wallclock>
+#endif
 #include "nemowallclock_p.h"
 
 #include <mce/dbus-names.h>
diff --git a/src/src.pro b/src/src.pro
index 28764a1..d3c3471 100644
--- a/src/src.pro
+++ b/src/src.pro
@@ -21,7 +21,7 @@ SOURCES += plugin.cpp \
 HEADERS += nemowallclock.h \
             nemowallclock_p.h
 
-LIBS += -ltimed-qt5
+LIBS += -ltimed-qt$${QT_MAJOR_VERSION}
 
 QT += dbus
 SOURCES += nemowallclock_meego.cpp
diff --git a/tests/common.pri b/tests/common.pri
index 56df61f..337680d 100644
--- a/tests/common.pri
+++ b/tests/common.pri
@@ -1,5 +1,5 @@
 QT = testlib qml
 TEMPLATE = app
 
-target.path = /opt/tests/nemo-qml-plugins-qt5/time
+target.path = /opt/tests/nemo-qml-plugins-qt$${QT_MAJOR_VERSION}/time
 INSTALLS += target
diff --git a/tests/tests.pro b/tests/tests.pro
index d6ffd78..61e161b 100644
--- a/tests/tests.pro
+++ b/tests/tests.pro
@@ -4,7 +4,7 @@ SUBDIRS = wallclock
 unix{
     tests_xml.target = tests.xml
     tests_xml.files = tests.xml
-    tests_xml.path = /opt/tests/nemo-qml-plugins-qt5/time
+    tests_xml.path = /opt/tests/nemo-qml-plugins-qt$${QT_MAJOR_VERSION}/time
     tests_xml.CONFIG = no_check_exist
     tests_xml.commands = sed \'s%@PATH@%$${tests_xml.path}%\' $$PWD/tests.xml.in > $$PWD/tests.xml
 
diff --git a/tests/wallclock/wallclock.pro b/tests/wallclock/wallclock.pro
index 49e9e9b..553a77f 100644
--- a/tests/wallclock/wallclock.pro
+++ b/tests/wallclock/wallclock.pro
@@ -5,7 +5,7 @@ SOURCES += tst_wallclock.cpp
 
 tests_qml.target = update.qml
 tests_qml.files = update.qml
-tests_qml.path = /opt/tests/nemo-qml-plugins-qt5/time
+tests_qml.path = /opt/tests/nemo-qml-plugins-qt$${QT_MAJOR_VERSION}/time
 
 DEFINES += TEST_DIRECTORY=\\\"$$tests_qml.path\\\"
 INSTALLS += tests_qml
-- 
2.41.0

