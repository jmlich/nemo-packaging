From 40e568d3c2c76152afeff75c6347c288a7d3cdcc Mon Sep 17 00:00:00 2001
From: Chupligin Sergey <neochapay@gmail.com>
Date: Mon, 12 Dec 2022 16:07:27 +0000
Subject: [PATCH] Allow build with qt6

---
 ofonotest/ofonotest.pro             |  4 ++--
 plugin/plugin.pro                   |  2 +-
 src/qofono-qt6.prf                  |  7 +++++++
 src/src.pro                         | 16 ++++++++--------
 test/auto/tests/testcase.pri        |  4 ++--
 test/auto/tst_qofono/tst_qofono.pro |  6 +++---
 6 files changed, 23 insertions(+), 16 deletions(-)
 create mode 100644 src/qofono-qt6.prf

diff --git a/ofonotest/ofonotest.pro b/ofonotest/ofonotest.pro
index 702d660..625dfaa 100644
--- a/ofonotest/ofonotest.pro
+++ b/ofonotest/ofonotest.pro
@@ -5,7 +5,7 @@ SOURCES += main.cpp
 
 qml.files += \
     qml/ofonotest/main.qml
-qml.path = /opt/examples/libqofono-qt5/qml/ofonotest
+qml.path = /opt/examples/libqofono-qt$${QT_MAJOR_VERSION}/qml/ofonotest/main.qml
 
-target.path = /opt/examples/libqofono-qt5/
+target.path = /opt/examples/libqofono-qt$${QT_MAJOR_VERSION}/
 INSTALLS += target qml
diff --git a/plugin/plugin.pro b/plugin/plugin.pro
index e026fb5..33191a1 100644
--- a/plugin/plugin.pro
+++ b/plugin/plugin.pro
@@ -7,7 +7,7 @@ QT_VERSION=$$[QT_VERSION]
 
 QT += qml
 QT -= gui
-LIBS += -L../src -lqofono-qt5
+LIBS += -L../src -lqofono-qt$${QT_MAJOR_VERSION}
 
 SOURCES =  \ 
     qofonodeclarativeplugin.cpp \
diff --git a/src/qofono-qt6.prf b/src/qofono-qt6.prf
new file mode 100644
index 0000000..53f2d50
--- /dev/null
+++ b/src/qofono-qt6.prf
@@ -0,0 +1,7 @@
+prefix=/usr
+exec_prefix=$${prefix}
+
+DEPENDPATH += $${prefix}/include/qofono-qt6
+INCLUDEPATH += $${prefix}/include/qofono-qt6
+LIBS += -L $${exec_prefix}/lib -lqofono-qt6
+
diff --git a/src/src.pro b/src/src.pro
index 357eeee..ec2846a 100644
--- a/src/src.pro
+++ b/src/src.pro
@@ -7,8 +7,8 @@ QMAKE_CXXFLAGS += -Wno-unused-parameter
 
 include(version.pri)
 
-TARGET = qofono-qt5
-pkgconfig.path = $$[QT_INSTALL_LIBS]/pkgconfig-qt5
+TARGET = qofono-qt$${QT_MAJOR_VERSION}
+pkgconfig.path = $$[QT_INSTALL_LIBS]/pkgconfig-qt$${QT_MAJOR_VERSION}
 
 TEMPLATE = lib
 
@@ -53,7 +53,7 @@ XML_FILES += \
 
 OTHER_FILES += $$XML_FILES\
     version.pri \
-    qofono-qt5.prf
+    qofono-qt$${QT_MAJOR_VERSION}.prf
 
 SOURCES += \
     qofono.cpp \
@@ -142,11 +142,11 @@ HEADERS += \
     dbustypes_p.h \
     qofonoutils_p.h
 
-headers.path = $$INSTALL_ROOT$$PREFIX/include/qofono-qt5
-qtconfig.path = $$[QT_INSTALL_PREFIX]/share/qt5/mkspecs/features
-qtconfig.files = qofono-qt5.prf
-pkgconfig.files = qofono-qt5.pc
-xmlfiles.path = $$INSTALL_ROOT$$PREFIX/include/qofono-qt5/dbus
+headers.path = $$INSTALL_ROOT$$PREFIX/include/qofono-qt$${QT_MAJOR_VERSION}
+qtconfig.path = $$[QT_INSTALL_PREFIX]/share/qt$${QT_MAJOR_VERSION}/mkspecs/features
+qtconfig.files = qofono-qt$${QT_MAJOR_VERSION}.prf
+pkgconfig.files = qofono-qt$${QT_MAJOR_VERSION}.pc
+xmlfiles.path = $$INSTALL_ROOT$$PREFIX/include/qofono-qt$${QT_MAJOR_VERSION}/dbus
 
 DBUS_INTERFACES += ofono_assisted_satellite_navigation
 ofono_assisted_satellite_navigation.files = dbus/ofono_assisted_satellite_navigation.xml
diff --git a/test/auto/tests/testcase.pri b/test/auto/tests/testcase.pri
index 810f657..fbdbe56 100644
--- a/test/auto/tests/testcase.pri
+++ b/test/auto/tests/testcase.pri
@@ -3,7 +3,7 @@ QT = core testlib dbus
 QOFONO_DIR = ../../../src/
 INCLUDEPATH += ../lib ../ $$QOFONO_DIR
 
-LIBS += -L$$QOFONO_DIR -lqofono-qt5
-target.path = /opt/tests/libqofono-qt5
+LIBS += -L$$QOFONO_DIR -lqofono-qt$${QT_MAJOR_VERSION}
+target.path = /opt/tests/libqofono-qt$${QT_MAJOR_VERSION}
 
 INSTALLS += target
diff --git a/test/auto/tst_qofono/tst_qofono.pro b/test/auto/tst_qofono/tst_qofono.pro
index 84bf197..d856e6b 100644
--- a/test/auto/tst_qofono/tst_qofono.pro
+++ b/test/auto/tst_qofono/tst_qofono.pro
@@ -7,9 +7,9 @@
 QT += testlib dbus # xmlpatterns
 QT -= gui
 
-LIBS += -lqofono-qt5
-TARGET = tst_qofonotest-qt5
-target.path = /opt/tests/libqofono-qt5
+LIBS += -lqofono-qt$${QT_MAJOR_VERSION}
+TARGET = tst_qofonotest-qt$${QT_MAJOR_VERSION}
+target.path = /opt/tests/libqofono-qt$${QT_MAJOR_VERSION}
 
 CONFIG   += console
 CONFIG   -= app_bundle
-- 
2.40.1

